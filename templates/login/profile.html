{% extends 'base.html' %}
{% load static %}
{% block title %} My Profile {% endblock %}

{% block head %}

<title>User Login</title>

{% endblock %}

{% block body %}


<!-- Profile 1 - Bootstrap Brain Component -->
<section class="bg-light py-3 py-md-5 py-xl-8" style="height: 100vh">
  <div class="container">
    <div class="row justify-content-md-center">
      <div class="col-12 col-md-10 col-lg-8 col-xl-7 col-xxl-6">
        <h5 class="welcome-to">Welcome To</h5>
        <h2 class="mb-4 display-5 text-center">{{profile.full_name}}'s Profile</h2>
        <div class="create-map">
          <a class="btn create-map-btn" href="{% url 'Login:dashboard' %}" type="button">My Maps</a>
        </div>
        <hr class="w-50 mx-auto mb-5 mb-xl-9 border-dark-subtle">
        {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row gy-4 gy-lg-0" style="column-gap: 40px;">
      <div class="col-12 col-lg-6 col-xl-6">
        <div class="row gy-4">
          <div class="col-12">
            <div class="card widget-card border-light shadow-sm">
              <div class="card-header card-title">{{ profile.full_name }}'s Informations</div>
              <div class="card-body">
                <div class="text-center mb-3">
                  {% if profile.profile_picture %}
                  <img src="{{ profile.profile_picture.url }}" class="rounded-circle profile-img" alt="Luna John">
                  {% else %}
                  <img src="/media/default_user.png" class="rounded-circle profile-img" alt="Default Profile Picture">
                  {% endif %}
                </div>
                <h5 class="text-center mb-1">{{ profile.full_name }}</h5>
                <p class="text-center text-secondary mb-4">{{ profile.user_status}}</p>
                <ul class="list-group list-group-flush mb-4">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <h6 class="m-0">Email:</h6>
                    <span>{{profile.email}}</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <h6 class="m-0">Phone:</h6>
                    <span>{{profile.phone}}</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <h6 class="m-0">Address:</h6>
                    <span>{{profile.address}}</span>
                  </li>
                </ul>
                <div class="d-grid m-0">
                  <a class="btn btn-outline-primary profile-edit-btn" href="{% url 'Login:edit_profile' profile.user.username %}" type="button">Edit Profile</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-5 col-xl-5">
        <div class="card widget-card border-light shadow-sm">
            <div class="card widget-card border-light shadow-sm">
              <div class="card-header card-title">{{profile.full_name}}'s Map Status</div>
              <div class="card-body">
                
                <div style="width: 400px; height: 400px;">
                    <canvas id="statusPieChart" width="300" height="300"></canvas>
                </div>
                <span class="badge status-badge" style="background-color: #007279;">Published ({{published_count}})</span>
                <span class="badge status-badge" style="background-color: #FFCE56;">Pending ({{pending_count}})</span>
                <span class="badge status-badge" style="background-color: #dc3545;">Reject ({{reject_count}})</span>
              </div>
            </div>
        </div>
      </div>
      
    </div>
  </div>
</section>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Get the count data passed from Django template context
  var publishedCount = {{ published_count }};
  var pendingCount = {{ pending_count }};
  var rejectCount = {{ reject_count }};

  // Create Pie Chart
  var ctx = document.getElementById('statusPieChart').getContext('2d');
  var statusPieChart = new Chart(ctx, {
      type: 'pie',
      data: {
          labels: ['Published', 'Pending', 'Rejected'], // Labels for the pie chart
          datasets: [{
              label: 'Map Status Distribution',
              data: [publishedCount, pendingCount, rejectCount], // The data for each slice of the pie
              backgroundColor: ['#007279', '#FFCE56', '#dc3545'], // Colors for each section
              borderColor: ['#ffffff', '#ffffff', '#ffffff'], // Border color for each section
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  position: 'right',
              },
              tooltip: {
                  callbacks: {
                      label: function(tooltipItem) {
                          return tooltipItem.label + ': ' + tooltipItem.raw; // Display count on hover
                      }
                  }
              }
          }
      }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
  // Function to filter maps by status
  function filterMaps(status) {
    const mapItems = document.querySelectorAll('.map-item');
    mapItems.forEach(item => {
      if (item.getAttribute('data-status') === status) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  }

  // Default display: Show "published" maps
  filterMaps('published');

  // Add event listeners for tab clicks
  const tabs = document.querySelectorAll('.nav-link');
  tabs.forEach(tab => {
    tab.addEventListener('click', function () {
      const targetStatus = this.id.split('-')[0]; // Get status from id (e.g., "published", "pending", "reject")
      filterMaps(targetStatus);
    });
  });
});
</script>

<style>
/* canvas#statusPieChart {
    height: 300px!important;
    width: 300px!important;
} */


  @media only screen and (max-width: 600px) {
    .card {
      width: 100%;
    }
  }
  
  .edit-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      color: white;
      padding: 3px 8px;
      background-color: #007279;
      font-size: 12px;
  }
  
  .edit-btn:hover {
      color: white;
      background-color: #dc3545;
  }
  .map-list-div {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
  }
  
  
  .map-list-title {
      font-size: 2.0rem;
      text-align: center;
      color: white;
      background-color: #007279;
      margin-bottom: 25px;
      padding: 5px;
  
  }
  
  .row {
      --bs-gutter-x: 0;
  }
  
  .left-container {
      box-shadow: 3px 0px 5px rgba(0, 0, 0, 0.2);
      padding: 10px;
      z-index: 999;
  }
  
  /* map list  */
  div#map-list-container {
    display: flex;
    padding: 25px 5px 5px 5px !important;
}

  .map-meta {
      display: flex; align-items: center;
      color: #007279;
    }
    
    .meta-container {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      padding: 5px;
    }

    span.material-symbols-outlined {
        font-size: 18px;
    }
    
    .card-body {
        padding: 0.5rem;
        background-color: #d3d3d33b;
        text-align: -webkit-center;
        height: 450px;
    }
  
    h5.card-title {
      color: #dc3545;
  }


/* ...................... */
.card-title {
  background-color: #007279; 
  color: white;
  text-align: center;
}

.profile-img{
  max-width: 150px;
  height: 150px;
  border: 1px solid #e3e3e3;
  padding: 3px;
}

.profile-edit-btn {
  border: 1px solid #007279;
  color: #dc3545;
}

.profile-edit-btn:hover {
  border: 1px solid #dc3545;
  background-color: #dc3545;
  color: white;
}
.welcome-to{
  margin-bottom: .5rem !important;
  text-align: center;
}

.status-badge {
  background-color: #dc3545;
  color: white;
}

.card-body .nav-link {
    color: #007279;
}


.create-map-btn {
  border-radius: 4px;
  background-color: #dc3545;
  border: none;
  color: #fff;
  text-align: center;
  font-size: 20px;
  width: 220px;
  transition: all 0.5s;
  cursor: pointer;
  box-shadow: 0 10px 20px -8px rgba(95, 95, 95, 0.7);
}

.create-map-btn{
  cursor: pointer;
  display: inline-block;
  position: relative;
  transition: 0.5s;
}

.create-map-btn:after {
  content: 'Â»';
  color: #ffff;
  position: absolute;
  opacity: 0;  
  top: 8px;
  right: -20px;
  transition: 0.5s;
}

.create-map-btn:hover{
  padding-right: 10px;
  padding-left:8px;
  background-color: #007279;
  color: #ffff;
}

.create-map-btn:hover:after {
  opacity: 1;
  right: 20px;
}

.create-map{
  text-align: center;
}
</style>



{% endblock %}



